<Window x:Class="OrgnTransplant.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OrgnTransplant"
        mc:Ignorable="d"
        Title="Система за управление на трансплантации"
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.Resources>
        <!-- Storyboards and Animations -->
        <Storyboard x:Key="FadeIn">
            <DoubleAnimation Storyboard.TargetProperty="Opacity"
                           From="0" To="1" Duration="0:0:0.5">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut"/>
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!-- Modern Navigation Button Style -->
        <Style x:Key="NavButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="18,14"/>
            <Setter Property="Margin" Value="0,6,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="12"
                                Padding="{TemplateBinding Padding}"
                                Margin="15,0"
                                BorderBrush="#E5E7EB"
                                BorderThickness="1">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background">
                        <Setter.Value>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#3B82F6" Offset="0"/>
                                <GradientStop Color="#60A5FA" Offset="1"/>
                            </LinearGradientBrush>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Foreground" Value="White"/>
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.02" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.02" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.0" Duration="0:0:0.2"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.0" Duration="0:0:0.2"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Organ Card Style - Completely New -->
        <Style x:Key="OrganCard" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="12"/>
            <Setter Property="RenderTransformOrigin" Value="0.5,0.5"/>
            <Setter Property="RenderTransform">
                <Setter.Value>
                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                </Setter.Value>
            </Setter>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="24"
                                Padding="20"
                                BorderThickness="0">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="30"
                                                  ShadowDepth="5"
                                                  Opacity="0.15"
                                                  Color="#000000"/>
                            </Border.Effect>
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource PinkGradient}"/>
                    <Trigger.EnterActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.12" Duration="0:0:0.4">
                                    <DoubleAnimation.EasingFunction>
                                        <ElasticEase EasingMode="EaseOut" Oscillations="1" Springiness="3"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.12" Duration="0:0:0.4">
                                    <DoubleAnimation.EasingFunction>
                                        <ElasticEase EasingMode="EaseOut" Oscillations="1" Springiness="3"/>
                                    </DoubleAnimation.EasingFunction>
                                </DoubleAnimation>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.EnterActions>
                    <Trigger.ExitActions>
                        <BeginStoryboard>
                            <Storyboard>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.0" Duration="0:0:0.3"/>
                                <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.0" Duration="0:0:0.3"/>
                            </Storyboard>
                        </BeginStoryboard>
                    </Trigger.ExitActions>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Modern ScrollBar Style -->
        <Style x:Key="ModernScrollBar" TargetType="{x:Type ScrollBar}">
            <Setter Property="Stylus.IsPressAndHoldEnabled" Value="false"/>
            <Setter Property="Stylus.IsFlicksEnabled" Value="false"/>
            <Setter Property="Width" Value="8"/>
            <Setter Property="MinWidth" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollBar}">
                        <Grid x:Name="GridRoot" Width="8" Background="Transparent">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Track x:Name="PART_Track" IsDirectionReversed="true" Focusable="false">
                                <Track.Thumb>
                                    <Thumb x:Name="Thumb">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Border x:Name="ThumbBorder"
                                                        CornerRadius="4"
                                                        Background="#C0C0C0"
                                                        Margin="2,0"
                                                        Opacity="0.5"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="#3B82F6"/>
                                                        <Setter TargetName="ThumbBorder" Property="Opacity" Value="0.8"/>
                                                        <Trigger.EnterActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation
                                                                        Storyboard.TargetName="ThumbBorder"
                                                                        Storyboard.TargetProperty="Opacity"
                                                                        To="0.8" Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.EnterActions>
                                                        <Trigger.ExitActions>
                                                            <BeginStoryboard>
                                                                <Storyboard>
                                                                    <DoubleAnimation
                                                                        Storyboard.TargetName="ThumbBorder"
                                                                        Storyboard.TargetProperty="Opacity"
                                                                        To="0.5" Duration="0:0:0.2"/>
                                                                </Storyboard>
                                                            </BeginStoryboard>
                                                        </Trigger.ExitActions>
                                                    </Trigger>
                                                    <Trigger Property="IsDragging" Value="True">
                                                        <Setter TargetName="ThumbBorder" Property="Background" Value="#2563EB"/>
                                                        <Setter TargetName="ThumbBorder" Property="Opacity" Value="1"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Modern ScrollViewer Style -->
        <Style x:Key="ModernScrollViewer" TargetType="{x:Type ScrollViewer}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ScrollViewer}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <ScrollContentPresenter Grid.Column="0" Grid.Row="0"
                                                   CanContentScroll="{TemplateBinding CanContentScroll}"/>

                            <ScrollBar x:Name="PART_VerticalScrollBar"
                                      Grid.Column="1" Grid.Row="0"
                                      Value="{TemplateBinding VerticalOffset}"
                                      Maximum="{TemplateBinding ScrollableHeight}"
                                      ViewportSize="{TemplateBinding ViewportHeight}"
                                      Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                      Style="{StaticResource ModernScrollBar}"
                                      Margin="0,0,4,0"/>

                            <ScrollBar x:Name="PART_HorizontalScrollBar"
                                      Orientation="Horizontal"
                                      Grid.Column="0" Grid.Row="1"
                                      Value="{TemplateBinding HorizontalOffset}"
                                      Maximum="{TemplateBinding ScrollableWidth}"
                                      ViewportSize="{TemplateBinding ViewportWidth}"
                                      Visibility="{TemplateBinding ComputedHorizontalScrollBarVisibility}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- Main Window Border -->
    <Border Background="{StaticResource BackgroundGradient}"
            CornerRadius="15"
            BorderBrush="#E5E7EB"
            BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="30" ShadowDepth="0" Opacity="0.15"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0"
                    Background="#FFFFFF"
                    CornerRadius="15,15,0,0"
                    BorderBrush="#E5E7EB"
                    BorderThickness="0,0,0,1"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,10,0">
                        <Button Content="─"
                                Click="MinimizeWindow_Click"
                                Style="{StaticResource {x:Type Button}}"
                                Width="40" Height="40"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="#64748B"
                                FontSize="16"
                                FontWeight="Bold"
                                Cursor="Hand"/>
                        <Button Content="□"
                                Click="MaximizeWindow_Click"
                                Style="{StaticResource {x:Type Button}}"
                                Width="40" Height="40"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="#64748B"
                                FontSize="14"
                                Cursor="Hand"/>
                        <Button Content="✕"
                                Click="CloseWindow_Click"
                                Style="{StaticResource {x:Type Button}}"
                                Width="40" Height="40"
                                Background="Transparent"
                                BorderThickness="0"
                                Foreground="#EF4444"
                                FontSize="16"
                                FontWeight="Bold"
                                Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Main Content Area -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

        <!-- Modern Sidebar -->
        <Border Grid.Column="0" Margin="20,20,10,20" CornerRadius="20"
                Background="#FFFFFF"
                BorderBrush="#E5E7EB"
                BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.08" Color="#000000"/>
            </Border.Effect>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Logo Section -->
                <Border Grid.Row="0" Padding="25" Margin="20,25,20,20">
                    <StackPanel>
                        <Border Width="70" Height="70" CornerRadius="35" Margin="0,0,0,15">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#3B82F6" Offset="0"/>
                                    <GradientStop Color="#60A5FA" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="15" ShadowDepth="0" Opacity="0.25" Color="#3B82F6"/>
                            </Border.Effect>
                            <TextBlock Text="⚕" FontSize="40" Foreground="White"
                                     HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="Система за управление" FontSize="13"
                                 Foreground="#64748B" HorizontalAlignment="Center"
                                 FontWeight="Medium"/>
                    </StackPanel>
                </Border>

                <!-- Hospital Selection -->
                <Border Grid.Row="1" Margin="20,0,20,20" Padding="18" CornerRadius="15"
                        Background="#F8FAFC"
                        BorderBrush="#E5E7EB"
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="🏥 Вашата болница" FontSize="12" FontWeight="SemiBold"
                                 Foreground="#64748B" Margin="0,0,0,10"/>

                        <ComboBox x:Name="HospitalSelectionBox"
                                FontSize="13"
                                Foreground="#1E293B"
                                Background="#FFFFFF"
                                BorderBrush="#CBD5E1"
                                BorderThickness="1"
                                Padding="12,10"
                                SelectionChanged="HospitalSelectionBox_SelectionChanged">
                            <ComboBox.Resources>
                                <Style TargetType="ComboBox">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ComboBox">
                                                <Grid>
                                                    <ToggleButton x:Name="ToggleButton"
                                                                Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                Focusable="False"
                                                                IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                                ClickMode="Press">
                                                        <ToggleButton.Template>
                                                            <ControlTemplate TargetType="ToggleButton">
                                                                <Border Background="{TemplateBinding Background}"
                                                                      BorderBrush="{TemplateBinding BorderBrush}"
                                                                      BorderThickness="{TemplateBinding BorderThickness}"
                                                                      CornerRadius="10">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="20"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        <ContentPresenter Grid.Column="0"
                                                                                        Margin="8,5"
                                                                                        HorizontalAlignment="Left"
                                                                                        VerticalAlignment="Center"/>
                                                                        <Path Grid.Column="1"
                                                                            Data="M 0 0 L 4 4 L 8 0 Z"
                                                                            Fill="#64748B"
                                                                            HorizontalAlignment="Center"
                                                                            VerticalAlignment="Center"/>
                                                                    </Grid>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </ToggleButton.Template>
                                                    </ToggleButton>
                                                    <ContentPresenter x:Name="ContentSite"
                                                                    Content="{TemplateBinding SelectionBoxItem}"
                                                                    ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                    ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                    Margin="12,10,28,10"
                                                                    VerticalAlignment="Center"
                                                                    HorizontalAlignment="Left"
                                                                    IsHitTestVisible="False"/>
                                                    <Popup x:Name="Popup"
                                                         Placement="Bottom"
                                                         IsOpen="{TemplateBinding IsDropDownOpen}"
                                                         AllowsTransparency="True"
                                                         Focusable="False"
                                                         PopupAnimation="Slide">
                                                        <Border Background="#FFFFFF"
                                                              BorderBrush="#CBD5E1"
                                                              BorderThickness="1"
                                                              CornerRadius="10"
                                                              MaxHeight="300">
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="15" ShadowDepth="0" Opacity="0.1" Color="#000000"/>
                                                            </Border.Effect>
                                                            <ScrollViewer Style="{StaticResource ModernScrollViewer}">
                                                                <StackPanel IsItemsHost="True"/>
                                                            </ScrollViewer>
                                                        </Border>
                                                    </Popup>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="#1E293B"/>
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Padding" Value="10,8"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#F1F5F9"/>
                                            <Setter Property="Foreground" Value="#3B82F6"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#DBEAFE"/>
                                            <Setter Property="Foreground" Value="#3B82F6"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.Resources>
                        </ComboBox>

                        <TextBlock x:Name="HospitalCityText"
                                 Text="Изберете болница"
                                 FontSize="11"
                                 Foreground="#94A3B8"
                                 Margin="0,10,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Navigation Buttons -->
                <StackPanel Grid.Row="2" Margin="0,10,0,0">
                    <Button Content="➕  Регистрация на донор"
                          Click="Add_Click"
                          Style="{StaticResource NavButton}"/>

                    <Button Content="👥  Преглед на донори"
                          Click="ViewDonors_Click"
                          Style="{StaticResource NavButton}"/>

                    <Button Content="🫀  Всички органи"
                          Click="viewAll_Click"
                          Style="{StaticResource NavButton}"/>

                    <Button Click="ViewMessages_Click"
                          Style="{StaticResource NavButton}">
                        <Grid>
                            <TextBlock Text="📬  Поща" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                            <!-- Notification Badge -->
                            <Border x:Name="MessagesBadge"
                                    Width="22" Height="22"
                                    CornerRadius="11"
                                    Background="#E74C3C"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    Margin="85,-6,0,0"
                                    Visibility="Collapsed">
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.6" Color="#E74C3C"/>
                                </Border.Effect>
                                <TextBlock x:Name="MessagesBadgeText"
                                         Text="0"
                                         FontSize="11"
                                         FontWeight="Bold"
                                         Foreground="White"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"/>
                            </Border>
                        </Grid>
                    </Button>
                </StackPanel>

            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1" Margin="15">

            <!-- Organs View -->
            <Grid x:Name="OrgansViewGrid" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Modern Header -->
                <Border Grid.Row="0" Padding="40,35" Margin="0,0,0,20" CornerRadius="25"
                        Background="{StaticResource PinkGradient}">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" ShadowDepth="5" Opacity="0.3" Color="#F5576C"/>
                    </Border.Effect>
                    <StackPanel>
                        <TextBlock Text="💝 Налични органи за трансплантация"
                                 FontSize="36" FontWeight="Bold"
                                 Foreground="White">
                            <TextBlock.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5" Color="#000000"/>
                            </TextBlock.Effect>
                        </TextBlock>
                        <TextBlock Text="Изберете тип орган, за да видите наличните донори и да управлявате заявките"
                                 FontSize="16"
                                 Foreground="White"
                                 Opacity="0.95"
                                 Margin="0,15,0,0"
                                 LineHeight="24"
                                 TextWrapping="Wrap"/>
                    </StackPanel>
                </Border>

                <!-- Organ Cards with New Design -->
                <ScrollViewer Grid.Row="1"
                            VerticalScrollBarVisibility="Auto"
                            Padding="10,0,10,20"
                            Style="{StaticResource ModernScrollViewer}">
                    <WrapPanel x:Name="ImagePanel" ItemWidth="220" ItemHeight="260">

                        <!-- Heart -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Сърце" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FFE5E9" Offset="0"/>
                                            <GradientStop Color="#FFD4DA" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Chest/Heart.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Сърце" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Kidney -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Бъбрек" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FFF5E6" Offset="0"/>
                                            <GradientStop Color="#FFE8CC" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Abdomen/Kidney.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Бъбрек" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Liver -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Черен дроб" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#E8F8F5" Offset="0"/>
                                            <GradientStop Color="#D5F4E6" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Abdomen/Liver.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Черен дроб" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Lung -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Бял дроб" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#EBF5FB" Offset="0"/>
                                            <GradientStop Color="#D6EAF8" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Chest/lung.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Бял дроб" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Pancreas -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Панкреас" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FEF9E7" Offset="0"/>
                                            <GradientStop Color="#FCF3CF" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Abdomen/Pancreas.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Панкреас" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Intestine -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Черва" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#F4ECF7" Offset="0"/>
                                            <GradientStop Color="#EBDEF0" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Abdomen/Intestine.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Черва" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Stomach -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Стомах" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FDF2E9" Offset="0"/>
                                            <GradientStop Color="#FAE5D3" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Abdomen/Stomach.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Стомах" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Artery -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Артерия" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#FADBD8" Offset="0"/>
                                            <GradientStop Color="#F5CBA7" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Chest/Pulmonary Artery.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Артерия" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                        <!-- Thymus -->
                        <Button Width="200" Height="240" Click="Organ_Click" Tag="Тимус" Style="{StaticResource OrganCard}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <Border Grid.Row="0" CornerRadius="20" Padding="15">
                                    <Border.Background>
                                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                            <GradientStop Color="#D6EAF8" Offset="0"/>
                                            <GradientStop Color="#AED6F1" Offset="1"/>
                                        </LinearGradientBrush>
                                    </Border.Background>
                                    <Image Source="/Resources/icons/Chest/Thymus.png"
                                         Height="100" Width="100" Stretch="Uniform"
                                         VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Row="1" Margin="0,15,0,0">
                                    <TextBlock Text="Тимус" FontSize="20" FontWeight="Bold"
                                             Foreground="#1A1A2E" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Button>

                    </WrapPanel>
                </ScrollViewer>
            </Grid>
            <!-- End of Organs View -->

            <!-- Donors View -->
            <Grid x:Name="DonorsViewGrid" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Padding="35,30" Margin="0,0,0,20" CornerRadius="25"
                        Background="{StaticResource PurpleGradient}">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" ShadowDepth="5" Opacity="0.3" Color="#667EEA"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel>
                            <TextBlock Text="👥 Регистрирани донори"
                                       FontSize="32" FontWeight="Bold"
                                       Foreground="White">
                                <TextBlock.Effect>
                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5" Color="#000000"/>
                                </TextBlock.Effect>
                            </TextBlock>
                            <TextBlock Text="Преглед, търсене и управление на регистрирани донори в системата"
                                       FontSize="15"
                                       Foreground="White"
                                       Opacity="0.95"
                                       Margin="0,12,0,0"/>
                        </StackPanel>
                        <Button Content="← Назад"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Click="BackToOrgans_Click"
                                Background="White"
                                Foreground="#667EEA"
                                BorderThickness="0"
                                Padding="20,12"
                                Cursor="Hand"
                                FontSize="14"
                                FontWeight="Bold">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="12"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!-- Filters and Search -->
                <Border Grid.Row="1" Padding="25,20" Margin="0,0,0,15" CornerRadius="20">
                    <Border.Background>
                        <SolidColorBrush Color="White" Opacity="0.1"/>
                    </Border.Background>
                    <WrapPanel>
                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Търсене" FontSize="11" Foreground="White" Margin="0,0,0,8"/>
                            <TextBox x:Name="SearchBox" Width="250" Height="38"
                                     VerticalContentAlignment="Center"
                                     Padding="15,0"
                                     BorderBrush="White"
                                     BorderThickness="2"
                                     Foreground="White"
                                     Background="Transparent"
                                     FontSize="14">
                                <TextBox.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="10"/>
                                    </Style>
                                </TextBox.Resources>
                            </TextBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Болница" FontSize="11" Foreground="White" Margin="0,0,0,8"/>
                            <ComboBox x:Name="FilterHospitalBox" Width="200"
                                      Style="{StaticResource ModernComboBox}">
                                <ComboBoxItem Content="Всички болници" IsSelected="True"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Кръвна група" FontSize="11" Foreground="White" Margin="0,0,0,8"/>
                            <ComboBox x:Name="FilterBloodTypeBox" Width="150"
                                      Style="{StaticResource ModernComboBox}">
                                <ComboBoxItem Content="Всички" IsSelected="True"/>
                                <ComboBoxItem Content="A+"/>
                                <ComboBoxItem Content="A-"/>
                                <ComboBoxItem Content="B+"/>
                                <ComboBoxItem Content="B-"/>
                                <ComboBoxItem Content="AB+"/>
                                <ComboBoxItem Content="AB-"/>
                                <ComboBoxItem Content="O+"/>
                                <ComboBoxItem Content="O-"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Орган" FontSize="11" Foreground="White" Margin="0,0,0,8"/>
                            <ComboBox x:Name="FilterOrganBox" Width="150"
                                      Style="{StaticResource ModernComboBox}">
                                <ComboBoxItem Content="Всички органи" IsSelected="True"/>
                                <ComboBoxItem Content="Сърце"/>
                                <ComboBoxItem Content="Бъбрек"/>
                                <ComboBoxItem Content="Черен дроб"/>
                                <ComboBoxItem Content="Бял дроб"/>
                                <ComboBoxItem Content="Панкреас"/>
                            </ComboBox>
                        </StackPanel>
                    </WrapPanel>
                </Border>

                <!-- Donors Cards View -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="0,0,0,20" Style="{StaticResource ModernScrollViewer}">
                    <ItemsControl x:Name="DonorsDataGrid">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,15" CornerRadius="20" Padding="30">
                                    <Border.Background>
                                        <SolidColorBrush Color="White" Opacity="0.95"/>
                                    </Border.Background>
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="25" ShadowDepth="5" Opacity="0.15" Color="#000000"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Left Section: Avatar & Main Info -->
                                        <StackPanel Grid.Column="0" Margin="0,0,30,0">
                                            <!-- Avatar Circle -->
                                            <Border Width="90" Height="90" CornerRadius="45" Margin="0,0,0,18">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#667EEA" Offset="0"/>
                                                        <GradientStop Color="#764BA2" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <Border.Effect>
                                                    <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.3" Color="#667EEA"/>
                                                </Border.Effect>
                                                <TextBlock Text="👤"
                                                           FontSize="42"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Blood Type Badge -->
                                            <Border CornerRadius="12" Padding="18,10" HorizontalAlignment="Center">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                        <GradientStop Color="#F093FB" Offset="0"/>
                                                        <GradientStop Color="#F5576C" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <Border.Effect>
                                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3" Color="#F5576C"/>
                                                </Border.Effect>
                                                <TextBlock Text="{Binding BloodTypeDisplay}"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           Foreground="White"
                                                           HorizontalAlignment="Center"/>
                                            </Border>
                                        </StackPanel>

                                        <!-- Middle Section: Details Grid -->
                                        <Grid Grid.Column="1" Margin="0,5">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Name and Age -->
                                            <StackPanel Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,20">
                                                <TextBlock Text="{Binding FullName}"
                                                           FontSize="26"
                                                           FontWeight="Bold"
                                                           Foreground="#1A1A2E"/>
                                                <TextBlock Foreground="#7F8C8D" FontSize="14" Margin="0,5,0,0">
                                                    <Run Text="Възраст: "/>
                                                    <Run Text="{Binding Age, Mode=OneWay}" FontWeight="SemiBold"/>
                                                    <Run Text=" години"/>
                                                </TextBlock>
                                            </StackPanel>

                                            <!-- Left Column Info -->
                                            <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,25,0">
                                                <StackPanel Margin="0,0,0,15">
                                                    <TextBlock Text="🏥 Болница"
                                                               FontSize="12"
                                                               Foreground="#95A5A6"
                                                               Margin="0,0,0,6"/>
                                                    <TextBlock Text="{Binding Hospital}"
                                                               FontSize="14"
                                                               Foreground="#2C3E50"
                                                               FontWeight="SemiBold"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>

                                                <StackPanel>
                                                    <TextBlock Text="🫀 Органи за донорство"
                                                               FontSize="12"
                                                               Foreground="#95A5A6"
                                                               Margin="0,0,0,6"/>
                                                    <TextBlock Text="{Binding OrgansForDonation}"
                                                               FontSize="14"
                                                               Foreground="#2C3E50"
                                                               FontWeight="SemiBold"
                                                               TextWrapping="Wrap"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Right Column Info -->
                                            <StackPanel Grid.Row="1" Grid.Column="1">
                                                <StackPanel Margin="0,0,0,15">
                                                    <TextBlock Text="⏱ Взет преди"
                                                               FontSize="12"
                                                               Foreground="#95A5A6"
                                                               Margin="0,0,0,6"/>
                                                    <TextBlock Text="{Binding HarvestTimeDisplay}"
                                                               FontSize="14"
                                                               Foreground="#E67E22"
                                                               FontWeight="Bold"/>
                                                </StackPanel>

                                                <StackPanel>
                                                    <TextBlock Text="⭐ Състояние"
                                                               FontSize="12"
                                                               Foreground="#95A5A6"
                                                               Margin="0,0,0,6"/>
                                                    <TextBlock Text="{Binding QualityDisplay}"
                                                               FontSize="14"
                                                               Foreground="#27AE60"
                                                               FontWeight="Bold"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Right Section: Action Buttons -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="30,0,0,0">
                                            <Button Content="✏️ Редактирай"
                                                    Click="EditDonor_Click"
                                                    Tag="{Binding Id}"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Padding="22,14"
                                                    Margin="0,0,0,12"
                                                    Cursor="Hand"
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Width="160">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border CornerRadius="12" Padding="{TemplateBinding Padding}">
                                                            <Border.Background>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#667EEA" Offset="0"/>
                                                                    <GradientStop Color="#764BA2" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Border.Background>
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="10" ShadowDepth="3" Opacity="0.3" Color="#667EEA"/>
                                                            </Border.Effect>
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>

                                            <Button Content="🗑️ Изтрий"
                                                    Click="DeleteDonor_Click"
                                                    Tag="{Binding Id}"
                                                    Background="#E74C3C"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Padding="22,14"
                                                    Cursor="Hand"
                                                    FontSize="14"
                                                    FontWeight="SemiBold"
                                                    Width="160">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="12"
                                                                Padding="{TemplateBinding Padding}">
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="10" ShadowDepth="3" Opacity="0.3" Color="#E74C3C"/>
                                                            </Border.Effect>
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
            <!-- End of Donors View -->

            <!-- Organs Details View -->
            <Grid x:Name="OrgansDetailsGrid" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Padding="35,30" Margin="0,0,0,20" CornerRadius="25"
                        Background="{StaticResource CyanGradient}">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="30" ShadowDepth="5" Opacity="0.3" Color="#4FACFE"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel>
                            <TextBlock x:Name="OrganDetailsTitle" Text="🫀 Налични донори"
                                       FontSize="32" FontWeight="Bold"
                                       Foreground="White">
                                <TextBlock.Effect>
                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.5" Color="#000000"/>
                                </TextBlock.Effect>
                            </TextBlock>
                            <TextBlock Text="Списък на донорите, сортирани по близост до вашата болница"
                                       FontSize="15"
                                       Foreground="White"
                                       Opacity="0.95"
                                       Margin="0,12,0,0"/>
                        </StackPanel>
                        <Button Content="← Назад"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Click="BackToOrgans_Click"
                                Background="White"
                                Foreground="#4FACFE"
                                BorderThickness="0"
                                Padding="20,12"
                                Cursor="Hand"
                                FontSize="14"
                                FontWeight="Bold">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="12"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!-- Statistics Bar -->
                <Border Grid.Row="1" Padding="25,18" Margin="0,0,0,15" CornerRadius="20">
                    <Border.Background>
                        <SolidColorBrush Color="White" Opacity="0.1"/>
                    </Border.Background>
                    <Grid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Border CornerRadius="12" Padding="18,10" Margin="0,0,15,0">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#4FACFE" Offset="0"/>
                                        <GradientStop Color="#00F2FE" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3" Color="#4FACFE"/>
                                </Border.Effect>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📊 Общо: " FontSize="13" Foreground="White" Margin="0,0,8,0" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="TotalOrgansText" Text="0" FontSize="13" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                            </Border>
                            <Border CornerRadius="12" Padding="18,10">
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                        <GradientStop Color="#43E97B" Offset="0"/>
                                        <GradientStop Color="#38F9D7" Offset="1"/>
                                    </LinearGradientBrush>
                                </Border.Background>
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3" Color="#43E97B"/>
                                </Border.Effect>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📍 Най-близка: " FontSize="13" Foreground="White" Margin="0,0,8,0" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="ClosestDistanceText" Text="N/A" FontSize="13" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Toggle for Expired Organs -->
                        <Button x:Name="ShowExpiredToggle"
                                Content="👁️ Покажи изтекли"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Click="ShowExpiredToggle_Click"
                                Background="White"
                                Foreground="#1A1A2E"
                                BorderThickness="0"
                                Padding="18,10"
                                Cursor="Hand"
                                FontSize="13"
                                FontWeight="SemiBold">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="12"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </Grid>
                </Border>

                <!-- Organs List with Cards -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="0,0,0,20" Style="{StaticResource ModernScrollViewer}">
                    <ItemsControl x:Name="OrgansItemsControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Margin="0,0,0,15" CornerRadius="20" Padding="25">
                                    <Border.Background>
                                        <SolidColorBrush Color="White" Opacity="0.95"/>
                                    </Border.Background>
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="25" ShadowDepth="5" Opacity="0.15" Color="#000000"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Organ Image -->
                                        <Border Grid.Column="0" CornerRadius="15"
                                                Width="130" Height="130"
                                                VerticalAlignment="Center"
                                                Padding="15">
                                            <Border.Background>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                    <GradientStop Color="#F8F9FA" Offset="0"/>
                                                    <GradientStop Color="#E9ECEF" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Border.Background>
                                            <Image Source="{Binding IconPath}" Stretch="Uniform"/>
                                        </Border>

                                        <!-- Organ Details -->
                                        <StackPanel Grid.Column="1" Margin="30,10,25,10" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding OrganName}"
                                                       FontSize="24" FontWeight="Bold"
                                                       Foreground="#1A1A2E"
                                                       Margin="0,0,0,15"/>

                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="🏥 Болница:"
                                                           FontSize="14" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="120"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Hospital}"
                                                           FontSize="14"
                                                           Foreground="#2C3E50"
                                                           TextWrapping="Wrap"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="👤 Донор:"
                                                           FontSize="14" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="120"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Donor}"
                                                           FontSize="14"
                                                           Foreground="#2C3E50"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="⏱️ Оставащо време:"
                                                           FontSize="14" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="140"/>
                                                <TextBlock Grid.Column="1" Text="{Binding ViabilityTimeDisplay}"
                                                           FontSize="13"
                                                           Foreground="{Binding ViabilityColor}"
                                                           FontWeight="Bold"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,10">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="⭐ Качество:"
                                                           FontSize="14" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="140"/>
                                                <TextBlock Grid.Column="1" Text="{Binding QualityDisplay}"
                                                           FontSize="13"
                                                           Foreground="#34495E"/>
                                            </Grid>

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="ℹ️ Информация:"
                                                           FontSize="14" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="140"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AdditionalInfo}"
                                                           FontSize="13"
                                                           Foreground="#34495E"
                                                           TextWrapping="Wrap"
                                                           LineHeight="20"/>
                                            </Grid>
                                        </StackPanel>

                                        <!-- Distance Badge and Request Button -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="15,0,0,0">
                                            <Border CornerRadius="15" Padding="22,15" Margin="0,0,0,12">
                                                <Border.Background>
                                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                        <GradientStop Color="#4FACFE" Offset="0"/>
                                                        <GradientStop Color="#00F2FE" Offset="1"/>
                                                    </LinearGradientBrush>
                                                </Border.Background>
                                                <Border.Effect>
                                                    <DropShadowEffect BlurRadius="15" ShadowDepth="3" Opacity="0.3" Color="#4FACFE"/>
                                                </Border.Effect>
                                                <StackPanel HorizontalAlignment="Center">
                                                    <TextBlock Text="📍"
                                                               FontSize="24"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,0,8"/>
                                                    <TextBlock Text="{Binding DistanceDisplay}"
                                                               FontSize="20"
                                                               FontWeight="Bold"
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"/>
                                                    <TextBlock Text="разстояние"
                                                               FontSize="11"
                                                               Foreground="White"
                                                               Opacity="0.9"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,4,0,0"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Map Button -->
                                            <Button Content="🗺️ Карта"
                                                    Click="ShowMap_Click"
                                                    Tag="{Binding}"
                                                    Background="White"
                                                    Foreground="#4FACFE"
                                                    BorderThickness="0"
                                                    Padding="18,10"
                                                    Margin="0,0,0,12"
                                                    Cursor="Hand"
                                                    FontSize="13"
                                                    FontWeight="SemiBold">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="12"
                                                                Padding="{TemplateBinding Padding}">
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="8" ShadowDepth="2" Opacity="0.2" Color="#4FACFE"/>
                                                            </Border.Effect>
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>

                                            <Button Content="📨 Заяви орган"
                                                    Click="RequestOrgan_Click"
                                                    Tag="{Binding}"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Padding="18,12"
                                                    Cursor="Hand"
                                                    FontSize="14"
                                                    FontWeight="SemiBold">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border CornerRadius="12" Padding="{TemplateBinding Padding}">
                                                            <Border.Background>
                                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                                    <GradientStop Color="#43E97B" Offset="0"/>
                                                                    <GradientStop Color="#38F9D7" Offset="1"/>
                                                                </LinearGradientBrush>
                                                            </Border.Background>
                                                            <Border.Effect>
                                                                <DropShadowEffect BlurRadius="10" ShadowDepth="3" Opacity="0.3" Color="#43E97B"/>
                                                            </Border.Effect>
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
            <!-- End of Organs Details View -->

            </Grid>
        </Grid>
    </Grid>
    </Border>
</Window>
