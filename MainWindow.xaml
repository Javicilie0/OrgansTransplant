<Window x:Class="OrgnTransplant.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OrgnTransplant"
        mc:Ignorable="d"
        Title="Система за управление на трансплантации"
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F7FA">

    <Window.Resources>
        <!-- Modern Button Style -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#2C3E50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="Margin" Value="0,8,0,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#34495E"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Organ Card Style -->
        <Style x:Key="OrganCard" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="15"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="12"
                                Padding="15">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="15"
                                                  ShadowDepth="2"
                                                  Opacity="0.1"
                                                  Color="#000000"/>
                            </Border.Effect>
                            <ContentPresenter/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#ECF0F1"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Sidebar -->
        <Border Grid.Column="0" Background="#2C3E50">
            <Border.Effect>
                <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.3" Color="#000000"/>
            </Border.Effect>
            <StackPanel>
                <!-- Logo/Title Section -->
                <Border Background="#1A252F" Padding="20" Margin="0,0,0,30">
                    <StackPanel>
                        <TextBlock Text="⚕" FontSize="36" Foreground="#3498DB"
                                   HorizontalAlignment="Center" Margin="0,0,0,10"/>
                        <TextBlock Text="Трансплантация" FontSize="16" FontWeight="Bold"
                                   Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock Text="на органи" FontSize="11"
                                   Foreground="#95A5A6" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Hospital Info -->
                <Border Background="#34495E" Margin="15,0,15,20"
                        CornerRadius="8" Padding="15">
                    <StackPanel>
                        <TextBlock Text="Изберете вашата болница"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="#95A5A6" Margin="0,0,0,10"/>

                        <ComboBox x:Name="HospitalSelectionBox"
                                  FontSize="12"
                                  Foreground="White"
                                  Background="#2C3E50"
                                  BorderBrush="#3498DB"
                                  BorderThickness="1"
                                  Padding="8"
                                  SelectionChanged="HospitalSelectionBox_SelectionChanged">
                            <ComboBox.Resources>
                                <Style TargetType="ComboBox">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ComboBox">
                                                <Grid>
                                                    <ToggleButton x:Name="ToggleButton"
                                                                  Background="{TemplateBinding Background}"
                                                                  BorderBrush="{TemplateBinding BorderBrush}"
                                                                  BorderThickness="{TemplateBinding BorderThickness}"
                                                                  Focusable="False"
                                                                  IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                                                  ClickMode="Press">
                                                        <ToggleButton.Template>
                                                            <ControlTemplate TargetType="ToggleButton">
                                                                <Border Background="{TemplateBinding Background}"
                                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                                        CornerRadius="4">
                                                                    <Grid>
                                                                        <Grid.ColumnDefinitions>
                                                                            <ColumnDefinition Width="*"/>
                                                                            <ColumnDefinition Width="20"/>
                                                                        </Grid.ColumnDefinitions>
                                                                        <ContentPresenter Grid.Column="0"
                                                                                          Margin="8,5"
                                                                                          HorizontalAlignment="Left"
                                                                                          VerticalAlignment="Center"/>
                                                                        <Path Grid.Column="1"
                                                                              Data="M 0 0 L 4 4 L 8 0 Z"
                                                                              Fill="White"
                                                                              HorizontalAlignment="Center"
                                                                              VerticalAlignment="Center"/>
                                                                    </Grid>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </ToggleButton.Template>
                                                    </ToggleButton>
                                                    <ContentPresenter x:Name="ContentSite"
                                                                      Content="{TemplateBinding SelectionBoxItem}"
                                                                      ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                      ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                      Margin="8,5,28,5"
                                                                      VerticalAlignment="Center"
                                                                      HorizontalAlignment="Left"
                                                                      IsHitTestVisible="False"/>
                                                    <Popup x:Name="Popup"
                                                           Placement="Bottom"
                                                           IsOpen="{TemplateBinding IsDropDownOpen}"
                                                           AllowsTransparency="True"
                                                           Focusable="False"
                                                           PopupAnimation="Slide">
                                                        <Border Background="#2C3E50"
                                                                BorderBrush="#3498DB"
                                                                BorderThickness="1"
                                                                CornerRadius="4"
                                                                MaxHeight="300">
                                                            <ScrollViewer>
                                                                <StackPanel IsItemsHost="True"/>
                                                            </ScrollViewer>
                                                        </Border>
                                                    </Popup>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                                <Style TargetType="ComboBoxItem">
                                    <Setter Property="Foreground" Value="White"/>
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Padding" Value="8,6"/>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#3498DB"/>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="#2980B9"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </ComboBox.Resources>
                        </ComboBox>

                        <TextBlock x:Name="HospitalCityText"
                                   Text="Изберете болница от списъка"
                                   FontSize="11"
                                   Foreground="#BDC3C7"
                                   Margin="0,8,0,0"/>
                    </StackPanel>
                </Border>

                <!-- Navigation Buttons -->
                <StackPanel Margin="15,0">
                    <Button Content="➕ Регистрация на донор"
                            Click="Add_Click"
                            Style="{StaticResource ModernButton}"/>

                    <Button Content="👥 Преглед на донори"
                            Click="ViewDonors_Click"
                            Style="{StaticResource ModernButton}"/>

                    <Button Content="🫀 Всички органи"
                            Click="viewAll_Click"
                            Style="{StaticResource ModernButton}"/>

                    <Button Content="📬 Поща"
                            Click="ViewMessages_Click"
                            Style="{StaticResource ModernButton}"/>

                    <Button Content="🗄️ Зареди тестови данни"
                            Click="SeedTestData_Click"
                            Style="{StaticResource ModernButton}"
                            Margin="0,30,0,0"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Column="1">

            <!-- Organs View -->
            <Grid x:Name="OrgansViewGrid" Visibility="Visible">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="White" Padding="30,25" Margin="0,0,0,20">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                </Border.Effect>
                <Grid>
                    <StackPanel>
                        <TextBlock Text="Налични органи за трансплантация"
                                   FontSize="28" FontWeight="Bold"
                                   Foreground="#2C3E50"/>
                        <TextBlock Text="Изберете тип орган, за да видите наличните донори и да управлявате заявките за трансплантация"
                                   FontSize="13"
                                   Foreground="#7F8C8D"
                                   Margin="0,8,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Organ Cards Grid -->
            <ScrollViewer Grid.Row="1"
                          VerticalScrollBarVisibility="Auto"
                          Padding="15,0,15,20">
                <WrapPanel x:Name="ImagePanel" ItemWidth="200" ItemHeight="200">

                    <!-- Heart -->
                    <Button Width="170" Click="Organ_Click" Tag="Сърце" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Chest/Heart.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Сърце"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Сърце"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Kidney -->
                    <Button Width="170" Click="Organ_Click" Tag="Бъбрек" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Abdomen/Kidney.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Бъбрек"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Бъбрек"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Liver -->
                    <Button Width="170" Click="Organ_Click" Tag="Черен дроб" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Abdomen/Liver.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Черен дроб"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Черен дроб"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Lung -->
                    <Button Width="170" Click="Organ_Click" Tag="Бял дроб" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Chest/lung.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Бял дроб"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Бял дроб"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Pancreas -->
                    <Button Width="170" Click="Organ_Click" Tag="Панкреас" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Abdomen/Pancreas.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Панкреас"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Панкреас"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Intestine -->
                    <Button Width="170" Click="Organ_Click" Tag="Черва" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Abdomen/Intestine.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Черва"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Черва"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Stomach -->
                    <Button Width="170" Click="Organ_Click" Tag="Стомах" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Abdomen/Stomach.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Стомах"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Стомах"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Artery -->
                    <Button Width="170" Click="Organ_Click" Tag="Артерия" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Chest/Pulmonary Artery.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Артерия"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Артерия"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                    <!-- Thymus -->
                    <Button Width="170" Click="Organ_Click" Tag="Тимус" Style="{StaticResource OrganCard}">
                        <StackPanel>
                            <Image Source="Resources/icons/Chest/Thymus.png"
                                   Height="90" Width="90" Stretch="Uniform" Margin="0,5"/>
                            <TextBlock Text="Тимус"
                                       HorizontalAlignment="Center"
                                       FontSize="15" FontWeight="SemiBold"
                                       Foreground="#2C3E50" Margin="0,10,0,5"/>
                            <TextBlock Text="Тимус"
                                       HorizontalAlignment="Center"
                                       FontSize="11"
                                       Foreground="#95A5A6"/>
                        </StackPanel>
                    </Button>

                </WrapPanel>
            </ScrollViewer>
            </Grid>
            <!-- End of Organs View -->

            <!-- Donors View -->
            <Grid x:Name="DonorsViewGrid" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="White" Padding="30,25" Margin="0,0,0,20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel>
                            <TextBlock Text="Регистрирани донори"
                                       FontSize="28" FontWeight="Bold"
                                       Foreground="#2C3E50"/>
                            <TextBlock Text="Преглед, търсене и управление на регистрирани донори в системата"
                                       FontSize="13"
                                       Foreground="#7F8C8D"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Content="← Назад към органи"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Click="BackToOrgans_Click"
                                Background="#3498DB"
                                Foreground="White"
                                BorderThickness="0"
                                Padding="15,10"
                                Cursor="Hand"
                                FontSize="13">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="6"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#2980B9"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Border>

                <!-- Filters and Search -->
                <Border Grid.Row="1" Background="White" Padding="20,15" Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                    </Border.Effect>
                    <WrapPanel>
                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Търсене" FontSize="11" Foreground="#7F8C8D" Margin="0,0,0,5"/>
                            <TextBox x:Name="SearchBox" Width="250" Height="32"
                                     VerticalContentAlignment="Center"
                                     Padding="10,0"
                                     BorderBrush="#BDC3C7"
                                     BorderThickness="1"
                                     FontSize="13">
                                <TextBox.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="4"/>
                                    </Style>
                                </TextBox.Resources>
                            </TextBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Болница" FontSize="11" Foreground="#7F8C8D" Margin="0,0,0,5"/>
                            <ComboBox x:Name="FilterHospitalBox" Width="200" Height="32"
                                      VerticalContentAlignment="Center"
                                      BorderBrush="#BDC3C7"
                                      BorderThickness="1"
                                      FontSize="13">
                                <ComboBoxItem Content="Всички болници" IsSelected="True"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Кръвна група" FontSize="11" Foreground="#7F8C8D" Margin="0,0,0,5"/>
                            <ComboBox x:Name="FilterBloodTypeBox" Width="120" Height="32"
                                      VerticalContentAlignment="Center"
                                      BorderBrush="#BDC3C7"
                                      BorderThickness="1"
                                      FontSize="13">
                                <ComboBoxItem Content="Всички" IsSelected="True"/>
                                <ComboBoxItem Content="A+"/>
                                <ComboBoxItem Content="A-"/>
                                <ComboBoxItem Content="B+"/>
                                <ComboBoxItem Content="B-"/>
                                <ComboBoxItem Content="AB+"/>
                                <ComboBoxItem Content="AB-"/>
                                <ComboBoxItem Content="O+"/>
                                <ComboBoxItem Content="O-"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="Орган" FontSize="11" Foreground="#7F8C8D" Margin="0,0,0,5"/>
                            <ComboBox x:Name="FilterOrganBox" Width="150" Height="32"
                                      VerticalContentAlignment="Center"
                                      BorderBrush="#BDC3C7"
                                      BorderThickness="1"
                                      FontSize="13">
                                <ComboBoxItem Content="Всички органи" IsSelected="True"/>
                                <ComboBoxItem Content="Сърце"/>
                                <ComboBoxItem Content="Бъбрек"/>
                                <ComboBoxItem Content="Черен дроб"/>
                                <ComboBoxItem Content="Бял дроб"/>
                                <ComboBoxItem Content="Панкреас"/>
                            </ComboBox>
                        </StackPanel>

                        <StackPanel Margin="0,17,0,0">
                            <Button Content="🔍 Търси"
                                    Width="100" Height="32"
                                    Click="SearchDonors_Click"
                                    Background="#3498DB"
                                    Foreground="White"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    FontSize="13">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4"
                                                Padding="10,0">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#2980B9"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </WrapPanel>
                </Border>

                <!-- DataGrid -->
                <Border Grid.Row="2" Background="White" Margin="0,0,0,20" CornerRadius="8">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                    </Border.Effect>
                    <DataGrid x:Name="DonorsDataGrid"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              GridLinesVisibility="None"
                              HeadersVisibility="Column"
                              RowHeight="50"
                              Margin="15"
                              BorderThickness="0"
                              Background="White"
                              AlternatingRowBackground="#F8F9FA"
                              FontSize="13">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Име" Binding="{Binding FullName}" Width="200"/>
                            <DataGridTextColumn Header="Възраст" Binding="{Binding Age}" Width="80"/>
                            <DataGridTextColumn Header="ЕГН" Binding="{Binding MaskedEGN}" Width="110"/>
                            <DataGridTextColumn Header="Кръвна" Binding="{Binding BloodTypeDisplay}" Width="80"/>
                            <DataGridTextColumn Header="Болница" Binding="{Binding Hospital}" Width="*"/>
                            <DataGridTextColumn Header="Органи" Binding="{Binding OrgansForDonation}" Width="180"/>
                            <DataGridTextColumn Header="Дата" Binding="{Binding RegistrationDate, StringFormat='dd.MM.yyyy'}" Width="100"/>

                            <DataGridTemplateColumn Header="Действия" Width="150">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="✏"
                                                    Click="EditDonor_Click"
                                                    Tag="{Binding Id}"
                                                    Width="30" Height="30"
                                                    Margin="2"
                                                    Background="#3498DB"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Cursor="Hand"
                                                    ToolTip="Редактиране">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>

                                            <Button Content="🗑"
                                                    Click="DeleteDonor_Click"
                                                    Tag="{Binding Id}"
                                                    Width="30" Height="30"
                                                    Margin="2"
                                                    Background="#E74C3C"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Cursor="Hand"
                                                    ToolTip="Изтриване">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="4">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#ECF0F1"/>
                                <Setter Property="Foreground" Value="#2C3E50"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="10"/>
                                <Setter Property="BorderThickness" Value="0,0,0,2"/>
                                <Setter Property="BorderBrush" Value="#BDC3C7"/>
                                <Setter Property="Height" Value="40"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E8F4F8"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>

                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Padding" Value="10,0"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#D6EAF8"/>
                                        <Setter Property="Foreground" Value="#2C3E50"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.CellStyle>
                    </DataGrid>
                </Border>
            </Grid>
            <!-- End of Donors View -->

            <!-- Organs Details View -->
            <Grid x:Name="OrgansDetailsGrid" Visibility="Collapsed">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0" Background="White" Padding="30,25" Margin="0,0,0,20">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel>
                            <TextBlock x:Name="OrganDetailsTitle" Text="Налични донори"
                                       FontSize="28" FontWeight="Bold"
                                       Foreground="#2C3E50"/>
                            <TextBlock Text="Списък на донорите, сортирани по близост до вашата болница"
                                       FontSize="13"
                                       Foreground="#7F8C8D"
                                       Margin="0,8,0,0"/>
                        </StackPanel>
                        <Button Content="← Назад към органи"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center"
                                Click="BackToOrgans_Click"
                                Background="#3498DB"
                                Foreground="White"
                                BorderThickness="0"
                                Padding="15,10"
                                Cursor="Hand"
                                FontSize="13">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            CornerRadius="6"
                                            Padding="{TemplateBinding Padding}">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#2980B9"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </Grid>
                </Border>

                <!-- Statistics Bar -->
                <Border Grid.Row="1" Background="White" Padding="20,15" Margin="0,0,0,15">
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="10" ShadowDepth="1" Opacity="0.05" Color="#000000"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                            <Border Background="#3498DB" CornerRadius="6" Padding="15,8" Margin="0,0,15,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📊 Общо:" FontSize="12" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock x:Name="TotalOrgansText" Text="0" FontSize="12" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                            </Border>
                            <Border Background="#2ECC71" CornerRadius="6" Padding="15,8" Margin="0,0,15,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="📍 Най-близка:" FontSize="12" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock x:Name="ClosestDistanceText" Text="N/A" FontSize="12" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Organs List with Cards -->
                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" Padding="0,0,0,20">
                    <ItemsControl x:Name="OrgansItemsControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" Margin="0,0,0,15" CornerRadius="10" Padding="20">
                                    <Border.Effect>
                                        <DropShadowEffect BlurRadius="15" ShadowDepth="2" Opacity="0.08" Color="#000000"/>
                                    </Border.Effect>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="140"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Organ Image -->
                                        <Border Grid.Column="0" Background="#F8F9FA" CornerRadius="8"
                                                Width="120" Height="120"
                                                VerticalAlignment="Center"
                                                Padding="10">
                                            <Image Source="{Binding IconPath}" Stretch="Uniform"/>
                                        </Border>

                                        <!-- Organ Details -->
                                        <StackPanel Grid.Column="1" Margin="25,10,20,10" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding OrganName}"
                                                       FontSize="20" FontWeight="Bold"
                                                       Foreground="#2C3E50"
                                                       Margin="0,0,0,12"/>

                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="🏥 Болница:"
                                                           FontSize="13" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="100"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Hospital}"
                                                           FontSize="13"
                                                           Foreground="#2C3E50"
                                                           TextWrapping="Wrap"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="👤 Донор:"
                                                           FontSize="13" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="100"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Donor}"
                                                           FontSize="13"
                                                           Foreground="#2C3E50"/>
                                            </Grid>

                                            <Grid Margin="0,0,0,8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="ℹ️ Информация:"
                                                           FontSize="13" FontWeight="SemiBold"
                                                           Foreground="#7F8C8D"
                                                           Width="100"/>
                                                <TextBlock Grid.Column="1" Text="{Binding AdditionalInfo}"
                                                           FontSize="12"
                                                           Foreground="#34495E"
                                                           TextWrapping="Wrap"
                                                           LineHeight="18"/>
                                            </Grid>
                                        </StackPanel>

                                        <!-- Distance Badge and Request Button -->
                                        <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="10,0,0,0">
                                            <Border Background="#3498DB"
                                                    CornerRadius="10"
                                                    Padding="20,12">
                                                <StackPanel HorizontalAlignment="Center">
                                                    <TextBlock Text="📍"
                                                               FontSize="20"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,0,0,5"/>
                                                    <TextBlock Text="{Binding DistanceDisplay}"
                                                               FontSize="18"
                                                               FontWeight="Bold"
                                                               Foreground="White"
                                                               HorizontalAlignment="Center"/>
                                                    <TextBlock Text="разстояние"
                                                               FontSize="10"
                                                               Foreground="#ECF0F1"
                                                               HorizontalAlignment="Center"
                                                               Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </Border>

                                            <Button Content="📨 Заяви орган"
                                                    Click="RequestOrgan_Click"
                                                    Tag="{Binding}"
                                                    Background="#27AE60"
                                                    Foreground="White"
                                                    BorderThickness="0"
                                                    Padding="15,10"
                                                    Margin="0,15,0,0"
                                                    Cursor="Hand"
                                                    FontSize="13"
                                                    FontWeight="SemiBold">
                                                <Button.Template>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}"
                                                                CornerRadius="8"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Button.Template>
                                                <Button.Style>
                                                    <Style TargetType="Button">
                                                        <Style.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter Property="Background" Value="#229954"/>
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Button.Style>
                                            </Button>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
            <!-- End of Organs Details View -->

        </Grid>
    </Grid>
</Window>
